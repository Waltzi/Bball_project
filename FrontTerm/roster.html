<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Women's Basketball Roster</title>
    <link rel="stylesheet" href="roster.css">   
</head>
<body>
    <!-- Back Button -->
    <h1>Moravian Women's Basketball Roster</h1>
    <button id="back_button" onclick="location.href='index.html'">Back</button>
    <div class="container">
        <table>
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Number</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="roster_body">
            
            </tbody>
        </table>
        <form id="player_form" onsubmit="handleSubmit(event)">
            <input type="text" id="firstName" name="firstName" required>
            <input type="text" id="lastName" name="lastName" required>
            <input type="number" id="number" name="number" required>
            <button type="submit">Add Player</button>
        </form>
        <script>
            //function to display data
async function fetchData() {
  try {
    const response = await fetch('http://localhost:8080/basketball_api/getPlayers');
    if (!response.ok) {
      throw new Error('Failed to fetch data');
    }
    const jsonData = await response.text();
    const parsedData = parseJson(jsonData); // Parse JSON response

    console.log('Parsed Data:', parsedData);
    return parsedData;
  } catch (error) {
    console.error('Error fetching data:', error);
    throw error;
  }
}

function DataDisplay() {
  const [data, setData] = useState(null);

  useEffect(() => {
    const apiUrl = 'http://localhost:8080/basketball_api/getPlayers';
    fetchData(apiUrl)
      .then((parsedData) => {
        setData(parsedData); // Set parsed data in component state
      })
      .catch((error) => {
        console.error('Error fetching data:', error);
      });
  }, []); // Run once on component mount
}

// Function to add a player to the API
async function addPlayer(player) {
  try {
      const response = await fetch('http://localhost:8080/basketball_api/addPlayer', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify(player)
      });
      if (!response.ok) {
          throw new Error('Failed to add player');
      }
      const addedPlayer = await response.json();
      console.log('Added player:', addedPlayer);
      return addedPlayer;
  } catch (error) {
      console.error('Error adding player:', error);
      throw error;
  }
}
  
  // Function to handle form submission
async function handleSubmit(event) {
  event.preventDefault(); // Prevent default form submission

  const firstName = document.getElementById('firstName').value;
  const lastName = document.getElementById('lastName').value;
  const number = document.getElementById('number').value;

  const player = {
      id: null, // ID will be generated by the API
      firstName: first_name,
      lastName: last_name,
      number: jersey_number
  };

  try {
      const addedPlayer = await addPlayer(player); // Call addPlayer function with player data
      console.log('Player added:', addedPlayer);

      // Optionally, update the UI or display a success message
      alert('Player added successfully!');
  } catch (error) {
      console.error('Error adding player:', error);
      // Handle error (e.g., display error message)
      alert('Failed to add player. Please try again.');
  }
}
        </script>
    </div>
    <script src="app.js"></script>
</body>
</html>
